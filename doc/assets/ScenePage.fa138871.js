import{R as k,V as E,P as T,W as G,s as L,S as R,D as W,G as u,A as _,T as f,M as w,a as g,b as C,c as y,d as D,C as z,O as P,e as O}from"./three.module.cd558234.js";import{R as A,O as N}from"./resource-tracker.b1346dd0.js";import{e as F}from"./SceneView.fd8eaf16.js";import{p as B,B as U,C as j,w as I,o as H,k as Y,l as q,e as X,n as V}from"./index.46de491b.js";const $="/make-a-three-scene/assets/earth3.b9422a69.jpg";class J{constructor(s,i){typeof s=="string"?this.sceneDom=document.querySelector(s):this.sceneDom=s;const t={satelliteData:new Array(5).fill({name:"\u9ED8\u8BA4\u5185\u5BB9",count:100,funding:200}),colors:["#ff7920","#ffc50f","#02ebe9"],speed:.001,radius:"width",scaleNum:1};i&&Object.keys(i).forEach(e=>{e in t&&(t[e]=i[e])}),this.intersects=[],this.raycaster=new k,this.pointer=new E,this.hoverSprite=null,this.hoverName=null,this.clickSprite=null,this.satelliteData=t.satelliteData,this.satelliteCount=t.satelliteData.length,this.colors=t.colors,this.speed=t.speed,t.radius==="width"?this.radius=this.sceneDom.clientWidth*t.scaleNum/2:t.radius==="height"?this.radius=this.sceneDom.clientHeight*t.scaleNum/2:typeof t.radius=="number"?this.radius=t.radius:this.radius=this.sceneDom.clientHeight*t.scaleNum/2,this.pointerMoveCopy=this.pointerMove.bind(this),this.meshOnclickCopy=this.meshOnclick.bind(this),this.meshMouseDownCopy=this.meshMouceDown.bind(this),this.meshMouseUpCopy=this.meshMouceUp.bind(this),this.onWindowResizeCopy=this.onWindowResize.bind(this),this.animationId=null,this.satelliteTrack=new A}init(){const s=this.sceneDom.clientWidth,i=this.sceneDom.clientHeight;this.camera=new T(60,s/i,1,2e3),this.camera.position.z=this.radius*1.3,this.renderer=new G({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(s,i),this.renderer.outputEncoding=L,this.sceneDom.appendChild(this.renderer.domElement),this.scene=new R;const t=new W(16777215,7);t.position.set(this.radius*5,this.radius*2,this.radius);const e=new u;e.add(t),this.lightGroup=e,this.scene.add(e);const n=new _(8900331,.7);this.scene.add(n),this.controls=new N(this.camera,this.renderer.domElement)}initEarth(){this.mainGroup=new u,this.mainGroup.name="\u5730\u7403\u548C\u536B\u661F";const s=new f().load($),i=new w(new g(this.radius/2,100,100),new C({map:s}));i.name="\u5730\u7403",this.Earth=i,this.mainGroup.add(i);const t=new f().load(F),e=new y(new D({map:t}));e.scale.x=e.scale.y=e.scale.z=this.radius*1.3,e.name="\u5730\u7403\u5149\u6655",this.EarthAureole=e,this.scene.add(e)}initSatellites(){this.rotaionMap={},this.satelliteGroup=new u,this.satelliteGroup.name="\u536B\u661F\u5B9E\u4F53";for(let s=0;s<this.satelliteCount;s++){const{resX:i,resY:t}=this.getRotationPos(),e=this.initSatellite(this.radius/1.6,{x:i,y:t,z:0},Math.random()*.005+this.speed,this.satelliteData[s]);this.satelliteGroup.add(e)}this.mainGroup.add(this.satelliteGroup),this.scene.add(this.mainGroup)}getRotationPos(){let s,i;for(let t=0;t<100;t++){let e=Number((-Math.PI*Math.random()*2).toFixed(2)),n=Number((Math.PI*Math.random()*2).toFixed(2));s=e,i=n;let o=String(e)+"&"+String(n);if(o in this.rotaionMap)continue;let r=!0;for(const a in this.rotaionMap)if(Math.abs(this.rotaionMap[a][0]-e)<.5&&Math.abs(this.rotaionMap[a][1]-n)<.5){r=!1;break}if(r){this.rotaionMap[o]=[e,n];break}}return{resX:s,resY:i}}initSatellite(s,i,t,e){const n=new w(new g(1,1,1),new C({transparent:!0,opacity:0})),o=this.initDomCanvas(e),r=new D({map:new z(o)}),a=new y(r);a.scale.x=o.width/2,a.scale.y=o.height/2,a.scale.z=o.height/2,a.position.set(s,0,0),a.name=e.name;const m=new P;return m.add(a),n.add(m),n.rotation.set(i.x,i.y,i.z),n.name=e.name,n.selfSpeed=t,n}initDomCanvas(s){const i=document.createElement("canvas"),t=this.calcCurFontSize(),e=10,n=2,r=t*12;i.width=r+2*e+2*n,i.height=t*4+2*e+2*n;const a=i.getContext("2d"),m="rgba(71, 166, 255, 0.7)",S="rgba(15, 106, 217, 0.2)",v="#c8daff",M="#00d4ff";a.fillStyle=S,a.fillRect(0,0,i.width,i.height),a.strokeStyle=m,a.strokeRect(n,n,i.width-n*2,i.height-n*2),a.font=`normal ${t}px YouSheBiaoTiHei`;let h="";for(let d of s.name)if(h+=d,a.measureText(h).width>r){h=h.slice(0,h.length-3)+"...";break}a.fillStyle=v,a.fillText(h,e,t+e),a.fillStyle=M;let c="",b=r-5*t-2*e;for(let d of String(s.count))if(c+=d,a.measureText(c).width>b){c=c.slice(0,c.length-3)+"...";break}a.fillText("\u6570\u91CF",e,2*t+2*e),a.fillText(c,5*t+2*e,2*t+2*e);let l="",x=r-5*t-2*e;for(let d of String(s.funding))if(l+=d,a.measureText(l).width>x){l=l.slice(0,l.length-3)+"...";break}return a.fillText("\u91D1\u989D\uFF08\u4E07\uFF09",e,3*t+3*e),a.fillText(l,5*t+2*e,3*t+3*e),i}calcCurFontSize(){let s=window.innerWidth;return s>=3840?40:s>=2560?30:s>=1920?26:s>=1600?20:s>=1280?18:16}reRenderSatellites(s){this.satelliteGroup&&(this.satelliteData=s,this.satelliteCount=s.length,this.satelliteGroup.clear(),this.mainGroup.remove(this.satelliteGroup),this.initSatellites(),this.render())}pointerMove(s){const i=this.sceneDom.getBoundingClientRect();if(this.pointer.x=(s.clientX-i.left)/this.sceneDom.offsetWidth*2-1,this.pointer.y=-((s.clientY-i.top)/this.sceneDom.offsetHeight)*2+1,this.raycaster.setFromCamera(this.pointer,this.camera),this.scene.children&&Array.isArray(this.scene.children)){const t=this.scene.children.find(n=>n.name==="\u5730\u7403\u548C\u536B\u661F"),e=t?t.children.find(n=>n.name==="\u536B\u661F\u5B9E\u4F53"):void 0;this.intersects=this.raycaster.intersectObjects(e?e.children:[])}}meshOnclick(){this.UpEndTime-this.downStartTime>150||this.intersects[0]&&(this.clickSprite=this.intersects[0].object.name,this.sceneDom.dispatchEvent(new CustomEvent("satellite",{detail:{spriteName:this.clickSprite}})))}meshMouceDown(){this.downStartTime=Date.now()}meshMouceUp(){this.UpEndTime=Date.now()}onWindowResize(){const s=this.sceneDom.clientWidth,i=this.sceneDom.clientHeight;this.camera.aspect=s/i,this.camera.updateProjectionMatrix(),this.renderer.setSize(s,i),this.render()}addListeners(){this.sceneDom.addEventListener("pointermove",this.pointerMoveCopy),this.sceneDom.addEventListener("click",this.meshOnclickCopy),this.sceneDom.addEventListener("mousedown",this.meshMouseDownCopy),this.sceneDom.addEventListener("mouseup",this.meshMouseUpCopy),window.addEventListener("resize",this.onWindowResizeCopy,!1)}removeListeners(){this.sceneDom.addEventListener("pointermove",this.pointerMoveCopy),this.sceneDom.removeEventListener("click",this.meshOnclickCopy),this.sceneDom.removeEventListener("mousedown",this.meshMouseDownCopy),this.sceneDom.removeEventListener("mouseup",this.meshMouseUpCopy),this.sceneDom.removeEventListener("resize",this.onWindowResizeCopy)}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.render()}render(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.intersects.length>0?this.hoverSprite=this.intersects[0].object:(this.mainGroup.rotation.y+=.003,this.controls.update(),this.lightGroup.quaternion.copy(this.camera.quaternion))}run(){this.init(),this.initEarth(),this.initSatellites(),this.satelliteTrack.track(this.camera),this.satelliteTrack.track(this.renderer),this.satelliteTrack.track(this.scene),this.satelliteTrack.track(this.controls),this.addListeners(),this.animate()}stop(){this.removeListeners(),this.satelliteTrack.dispose(),cancelAnimationFrame(this.animationId)}}const K={__name:"ScenePage",props:{foldChange:{type:Boolean}},setup(p){const s=p;let i={};return U(()=>{i=new J(".rotation-wrapper"),i.run()}),j(()=>{i.stop()}),I(()=>s.foldChange,()=>{setTimeout(()=>{i.onWindowResize()},350)}),(t,e)=>(H(),Y(O,null,{default:q(({theme:n})=>[X("div",{class:V(["rotation-wrapper",n])},null,2)]),_:1}))}},ie=B(K,[["__scopeId","data-v-d7f886a7"]]);export{ie as default};
