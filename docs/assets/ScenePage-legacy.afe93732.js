System.register(["./three.module-legacy.67a5e23a.js","./resource-tracker-legacy.89981e46.js","./SceneView-legacy.f2860873.js","./index-legacy.d382b655.js"],(function(e,t){"use strict";var i,s,n,a,r,o,h,l,c,d,m,u,p,w,f,g,y,v,D,C,k,S,M,b,E,x,T,z,G,R,L=document.createElement("style");return L.textContent=".rotation-wrapper[data-v-d7f886a7]{width:100%;height:100%}.rotation-wrapper.light[data-v-d7f886a7]{background:radial-gradient(circle,#729ecc 0%,#00456b 60%)}\n",document.head.appendChild(L),{setters:[e=>{i=e.R,s=e.V,n=e.P,a=e.W,r=e.s,o=e.S,h=e.D,l=e.G,c=e.A,d=e.T,m=e.M,u=e.a,p=e.b,w=e.c,f=e.d,g=e.C,y=e.O,v=e.e},e=>{D=e.R,C=e.O},e=>{k=e.e},e=>{S=e.p,M=e.B,b=e.C,E=e.w,x=e.o,T=e.k,z=e.l,G=e.e,R=e.n}],execute:function(){class t{constructor(e,t){this.sceneDom="string"==typeof e?document.querySelector(e):e;const n={satelliteData:new Array(5).fill({name:"默认内容",count:100,funding:200}),colors:["#ff7920","#ffc50f","#02ebe9"],speed:.001,radius:"width",scaleNum:1};t&&Object.keys(t).forEach((e=>{e in n&&(n[e]=t[e])})),this.intersects=[],this.raycaster=new i,this.pointer=new s,this.hoverSprite=null,this.hoverName=null,this.clickSprite=null,this.satelliteData=n.satelliteData,this.satelliteCount=n.satelliteData.length,this.colors=n.colors,this.speed=n.speed,"width"===n.radius?this.radius=this.sceneDom.clientWidth*n.scaleNum/2:"height"===n.radius?this.radius=this.sceneDom.clientHeight*n.scaleNum/2:"number"==typeof n.radius?this.radius=n.radius:this.radius=this.sceneDom.clientHeight*n.scaleNum/2,this.pointerMoveCopy=this.pointerMove.bind(this),this.meshOnclickCopy=this.meshOnclick.bind(this),this.meshMouseDownCopy=this.meshMouceDown.bind(this),this.meshMouseUpCopy=this.meshMouceUp.bind(this),this.onWindowResizeCopy=this.onWindowResize.bind(this),this.animationId=null,this.satelliteTrack=new D}init(){const e=this.sceneDom.clientWidth,t=this.sceneDom.clientHeight;this.camera=new n(60,e/t,1,2e3),this.camera.position.z=1.3*this.radius,this.renderer=new a({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,t),this.renderer.outputEncoding=r,this.sceneDom.appendChild(this.renderer.domElement),this.scene=new o;const i=new h(16777215,7);i.position.set(5*this.radius,2*this.radius,this.radius);const s=new l;s.add(i),this.lightGroup=s,this.scene.add(s);const d=new c(8900331,.7);this.scene.add(d),this.controls=new C(this.camera,this.renderer.domElement)}initEarth(){this.mainGroup=new l,this.mainGroup.name="地球和卫星";const e=(new d).load("/make-a-three-scene/assets/earth3.b9422a69.jpg"),t=new m(new u(this.radius/2,100,100),new p({map:e}));t.name="地球",this.Earth=t,this.mainGroup.add(t);const i=(new d).load(k),s=new w(new f({map:i}));s.scale.x=s.scale.y=s.scale.z=1.3*this.radius,s.name="地球光晕",this.EarthAureole=s,this.scene.add(s)}initSatellites(){this.rotaionMap={},this.satelliteGroup=new l,this.satelliteGroup.name="卫星实体";for(let e=0;e<this.satelliteCount;e++){const{resX:t,resY:i}=this.getRotationPos(),s=this.initSatellite(this.radius/1.6,{x:t,y:i,z:0},.005*Math.random()+this.speed,this.satelliteData[e]);this.satelliteGroup.add(s)}this.mainGroup.add(this.satelliteGroup),this.scene.add(this.mainGroup)}getRotationPos(){let e,t;for(let i=0;i<100;i++){let i=Number((-Math.PI*Math.random()*2).toFixed(2)),s=Number((Math.PI*Math.random()*2).toFixed(2));e=i,t=s;let n=String(i)+"&"+String(s);if(n in this.rotaionMap)continue;let a=!0;for(const e in this.rotaionMap)if(Math.abs(this.rotaionMap[e][0]-i)<.5&&Math.abs(this.rotaionMap[e][1]-s)<.5){a=!1;break}if(a){this.rotaionMap[n]=[i,s];break}}return{resX:e,resY:t}}initSatellite(e,t,i,s){const n=new m(new u(1,1,1),new p({transparent:!0,opacity:0})),a=this.initDomCanvas(s),r=new f({map:new g(a)}),o=new w(r);o.scale.x=a.width/2,o.scale.y=a.height/2,o.scale.z=a.height/2,o.position.set(e,0,0),o.name=s.name;const h=new y;return h.add(o),n.add(h),n.rotation.set(t.x,t.y,t.z),n.name=s.name,n.selfSpeed=i,n}initDomCanvas(e){const t=document.createElement("canvas"),i=this.calcCurFontSize(),s=10,n=12*i;t.width=n+20+4,t.height=4*i+20+4;const a=t.getContext("2d");a.fillStyle="rgba(15, 106, 217, 0.2)",a.fillRect(0,0,t.width,t.height),a.strokeStyle="rgba(71, 166, 255, 0.7)",a.strokeRect(2,2,t.width-4,t.height-4),a.font=`normal ${i}px YouSheBiaoTiHei`;let r="";for(let d of e.name)if(r+=d,a.measureText(r).width>n){r=r.slice(0,r.length-3)+"...";break}a.fillStyle="#c8daff",a.fillText(r,s,i+s),a.fillStyle="#00d4ff";let o="",h=n-5*i-20;for(let d of String(e.count))if(o+=d,a.measureText(o).width>h){o=o.slice(0,o.length-3)+"...";break}a.fillText("数量",s,2*i+20),a.fillText(o,5*i+20,2*i+20);let l="",c=n-5*i-20;for(let d of String(e.funding))if(l+=d,a.measureText(l).width>c){l=l.slice(0,l.length-3)+"...";break}return a.fillText("金额（万）",s,3*i+30),a.fillText(l,5*i+20,3*i+30),t}calcCurFontSize(){let e=window.innerWidth;return e>=3840?40:e>=2560?30:e>=1920?26:e>=1600?20:e>=1280?18:16}reRenderSatellites(e){this.satelliteGroup&&(this.satelliteData=e,this.satelliteCount=e.length,this.satelliteGroup.clear(),this.mainGroup.remove(this.satelliteGroup),this.initSatellites(),this.render())}pointerMove(e){const t=this.sceneDom.getBoundingClientRect();if(this.pointer.x=(e.clientX-t.left)/this.sceneDom.offsetWidth*2-1,this.pointer.y=-(e.clientY-t.top)/this.sceneDom.offsetHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera),this.scene.children&&Array.isArray(this.scene.children)){const e=this.scene.children.find((e=>"地球和卫星"===e.name)),t=e?e.children.find((e=>"卫星实体"===e.name)):void 0;this.intersects=this.raycaster.intersectObjects(t?t.children:[])}}meshOnclick(){this.UpEndTime-this.downStartTime>150||this.intersects[0]&&(this.clickSprite=this.intersects[0].object.name,this.sceneDom.dispatchEvent(new CustomEvent("satellite",{detail:{spriteName:this.clickSprite}})))}meshMouceDown(){this.downStartTime=Date.now()}meshMouceUp(){this.UpEndTime=Date.now()}onWindowResize(){const e=this.sceneDom.clientWidth,t=this.sceneDom.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.render()}addListeners(){this.sceneDom.addEventListener("pointermove",this.pointerMoveCopy),this.sceneDom.addEventListener("click",this.meshOnclickCopy),this.sceneDom.addEventListener("mousedown",this.meshMouseDownCopy),this.sceneDom.addEventListener("mouseup",this.meshMouseUpCopy),window.addEventListener("resize",this.onWindowResizeCopy,!1)}removeListeners(){this.sceneDom.addEventListener("pointermove",this.pointerMoveCopy),this.sceneDom.removeEventListener("click",this.meshOnclickCopy),this.sceneDom.removeEventListener("mousedown",this.meshMouseDownCopy),this.sceneDom.removeEventListener("mouseup",this.meshMouseUpCopy),this.sceneDom.removeEventListener("resize",this.onWindowResizeCopy)}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.render()}render(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.intersects.length>0?this.hoverSprite=this.intersects[0].object:(this.mainGroup.rotation.y+=.003,this.controls.update(),this.lightGroup.quaternion.copy(this.camera.quaternion))}run(){this.init(),this.initEarth(),this.initSatellites(),this.satelliteTrack.track(this.camera),this.satelliteTrack.track(this.renderer),this.satelliteTrack.track(this.scene),this.satelliteTrack.track(this.controls),this.addListeners(),this.animate()}stop(){this.removeListeners(),this.satelliteTrack.dispose(),cancelAnimationFrame(this.animationId)}}const L={__name:"ScenePage",props:{foldChange:{type:Boolean}},setup(e){const i=e;let s={};return M((()=>{s=new t(".rotation-wrapper"),s.run()})),b((()=>{s.stop()})),E((()=>i.foldChange),(()=>{setTimeout((()=>{s.onWindowResize()}),350)})),(e,t)=>(x(),T(v,null,{default:z((({theme:e})=>[G("div",{class:R(["rotation-wrapper",e])},null,2)])),_:1}))}};e("default",S(L,[["__scopeId","data-v-d7f886a7"]]))}}}));
